<?xml version="1.0" encoding="UTF-8"?>
<prov:document xmlns:prov="http://www.w3.org/ns/prov#"
               xmlns:xsd="http://www.w3.org/2001/XMLSchema#">

    <!-- Entidad: Tabla l2booksstage1 -->
    <prov:entity prov:id="ex:l2booksstage1">
        <prov:label>Tabla l2booksstage1</prov:label>
        <prov:description>
            Tabla intermedia derivada de l2_books. Se aplica un proceso de limpieza y normalización
            de texto sobre los campos ISBN, Book-Title, Book-Author y publisher, garantizando consistencia
            en formato, mayúsculas y validez estructural del identificador ISBN-10.
            Esta tabla prepara los datos para la integración posterior con l1books.
        </prov:description>

        <prov:wasDerivedFrom prov:entity="ex:l2_books"/>

        <!-- Columnas -->
        <prov:columns>

            <prov:column>
                <prov:name>isbn</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Identificador único del libro. Se normalizó eliminando caracteres extra, 
                    recortando al formato ISBN-10 válido y convirtiendo a mayúsculas. 
                    Se eliminaron registros con ISBN inválidos o no conformes a la expresión ^[0-9]{9}[0-9X]$.
                    Es esencial para el matching entre fuentes.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>Book-Title</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Se conserva como título principal. Fue normalizado aplicando conversión a mayúsculas,
                    eliminación de tildes y puntuación, supresión de paréntesis y corchetes, y compresión de espacios.
                    Esto garantiza la comparabilidad con títulos provenientes de l1books.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>Book-Author</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Representa el nombre del autor del libro. Se aplicó el mismo proceso de normalización que en el título:
                    conversión a mayúsculas, eliminación de acentos, puntuación y caracteres especiales.
                    Es un atributo clave para la deduplicación y el matching semántico.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>Year-Of-Publication</prov:name>
                <prov:type>xsd:gYear</prov:type>
                <prov:reason>
                    Año de publicación del libro. Se mantiene sin transformación en esta etapa,
                    ya que su formato es consistente en la fuente original.
                    Se usará para validaciones temporales y reglas de matching (R1–R2).
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>publisher</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Editorial del libro. Fue normalizada para eliminar puntuación, tildes, 
                    paréntesis y corchetes, y convertir a mayúsculas, permitiendo agrupar editoriales equivalentes.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>Image-URL-L</prov:name>
                <prov:type>xsd:anyURI</prov:type>
                <prov:reason>
                    URL de la imagen de portada en tamaño grande. Se conserva sin modificaciones,
                    ya que no afecta la integración y puede utilizarse para visualización o validación.
                </prov:reason>
            </prov:column>

        </prov:columns>
    </prov:entity>

    <!-- Actividad -->
    <prov:activity prov:id="ex:normalize_l2booksstage1"
                   prov:startTime="2025-11-01T10:00:00"
                   prov:endTime="2025-11-01T10:10:00">
        <prov:label>Normalización y validación de tabla l2_books → l2booksstage1</prov:label>
        <prov:description>
            Proceso SQL ejecutado en PostgreSQL que crea l2booksstage1 a partir de l2_books.
            Se aplicaron transformaciones sintácticas y validaciones estructurales:
            - Normalización de texto en Book-Title, Book-Author y publisher
              (eliminando tildes, sustitución de "ñ" por "n", signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas).
            - Limpieza del ISBN mediante expresiones regulares, truncamiento al formato ISBN-10 válido
              y eliminación de registros no conformes o duplicados potenciales.
        </prov:description>
        <prov:used prov:entity="ex:l2_books"/>
    </prov:activity>

    <!-- Agentes -->
    <prov:agent prov:id="ex:integra2">
        <prov:label>Grupo Integra2</prov:label>
        <prov:type>prov:Organization</prov:type>
        <prov:role>Encargado del diseño y ejecución del proceso de limpieza y validación de l2booksstage1.</prov:role>
    </prov:agent>
    <prov:agent prov:id="ex:postgresql_db">
        <prov:label>PostgreSQL Engine</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Motor de base de datos que ejecuta las consultas SQL de normalización y validación.</prov:role>
    </prov:agent>
        <prov:agent prov:id="ex:unaccent_extension">
        <prov:label>PostgreSQL unaccent extension</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Extensión utilizada para eliminar tildes y diacríticos de los textos durante la normalización.</prov:role>
    </prov:agent>

    <!-- Relaciones -->
    <prov:wasGeneratedBy prov:entity="ex:l2booksstage1"
                         prov:activity="ex:normalize_l2booksstage1"/>

    <prov:wasAssociatedWith prov:activity="ex:normalize_l2booksstage1"
                            prov:agent="ex:integra2"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l2booksstage1"
                            prov:agent="ex:postgresql_db"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l2booksstage1"
                            prov:agent="ex:unaccent_extension"/>

</prov:document>
