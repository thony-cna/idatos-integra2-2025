<?xml version="1.0" encoding="UTF-8"?>
<prov:document xmlns:prov="http://www.w3.org/ns/prov#"
               xmlns:xsd="http://www.w3.org/2001/XMLSchema#">

    <!-- Entidad: Tabla lnreviews -->
    <prov:entity prov:id="ex:lnreviews">
        <prov:label>Tabla lnreviews</prov:label>
        <prov:description>
            Tabla final de reseñas integrada que combina valoraciones de usuarios
            provenientes de los datasets l2_ratings (Books Dataset) y l1ratingsstage1
            (Amazon Books Reviews). Las reseñas se unifican bajo un esquema común
            con identificadores de usuario y libro consistentes dentro del modelo LN.
        </prov:description>

        <prov:wasDerivedFrom prov:entity="ex:l2_ratings"/>
        <prov:wasDerivedFrom prov:entity="ex:l1ratingsstage1"/>
        <prov:wasDerivedFrom prov:entity="ex:l1usersstage1"/>
        <prov:wasDerivedFrom prov:entity="ex:lnbooks"/>

        <!-- Columnas -->
        <prov:columns>
            <prov:column>
                <prov:name>user_id</prov:name>
                <prov:type>xsd:integer</prov:type>
                <prov:reason>
                    Identificador único del usuario dentro del sistema LN.
                    Proviene directamente de l2_ratings y, en el caso de las reseñas l1,
                    se obtiene mediante la unión entre l1ratingsstage1 y l1usersstage1.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>isbn</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Identificador del libro reseñado. Proviene de l2_ratings o de la columna id
                    en l1ratingsstage1, que se corresponde con el ISBN normalizado.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>rating</prov:name>
                <prov:type>xsd:integer</prov:type>
                <prov:reason>
                    Valoración numérica del usuario hacia el libro.
                    Corresponde a Book-Rating en l2_ratings y a review/score en l1ratingsstage1.
                </prov:reason>
            </prov:column>
        </prov:columns>
    </prov:entity>

    <!-- Actividad -->
    <prov:activity prov:id="ex:integrate_lnreviews"
                prov:startTime="2025-11-04T10:00:00"
                   prov:endTime="2025-11-06T15:15:00">
        <prov:label>Integración y depuración de reseñas (lnreviews)</prov:label>
        <prov:description>
            Proceso SQL ejecutado en PostgreSQL para crear la tabla lnreviews,
            unificando las reseñas provenientes de l2_ratings y l1ratingsstage1.
            La integración constó de tres etapas:
            (1) Inserción directa de registros de l2_ratings con campos User-ID, ISBN y Book-Rating.
            (2) Inserción de registros de l1ratingsstage1 tras un cruce con l1usersstage1
                para mapear user_id → User-ID y asegurar consistencia global en la clave de usuario.
            (3) Eliminación de reseñas sin correspondencia con ningún libro en lnbooks,
                asegurando integridad referencial dentro del modelo LN.
        </prov:description>
        <prov:used prov:entity="ex:l2_ratings"/>
        <prov:used prov:entity="ex:l1ratingsstage1"/>
        <prov:used prov:entity="ex:l1usersstage1"/>
        <prov:used prov:entity="ex:lnbooks"/>
    </prov:activity>

    <!-- Agentes -->
    <prov:agent prov:id="ex:integra2">
        <prov:label>Grupo Integra2</prov:label>
        <prov:type>prov:Organization</prov:type>
        <prov:role>Diseñó y ejecutó el proceso de integración de reseñas en el modelo LN.</prov:role>
    </prov:agent>
    <prov:agent prov:id="ex:postgresql_db">
        <prov:label>PostgreSQL Engine</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Ejecutó las consultas SQL de inserción y unión entre datasets.</prov:role>
    </prov:agent>

    <!-- Relaciones -->
    <prov:wasGeneratedBy prov:entity="ex:lnreviews"
                         prov:activity="ex:integrate_lnreviews"/>

    <prov:wasAssociatedWith prov:activity="ex:integrate_lnreviews"
                            prov:agent="ex:integra2"/>
    <prov:wasAssociatedWith prov:activity="ex:integrate_lnreviews"
                            prov:agent="ex:postgresql_db"/>

</prov:document>
