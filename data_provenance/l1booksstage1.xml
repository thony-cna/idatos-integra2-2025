<?xml version="1.0" encoding="UTF-8"?>
<prov:document xmlns:prov="http://www.w3.org/ns/prov#"
               xmlns:dcterms="http://purl.org/dc/terms/"
               xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
               xmlns:ex="http://example.org/">

    <!-- Entidad: Tabla l1booksstage1 -->
    <prov:entity prov:id="ex:l1booksstage1">
        <prov:label>Tabla l1booksstage1</prov:label>
        <prov:type>prov:Collection</prov:type>
        <dcterms:description>
            Tabla intermedia generada a partir de l1books, donde se aplican procesos de normalización
            sintáctica y limpieza de texto sobre los campos title, authors, publisher y publisheddate.
            Su objetivo es estandarizar formatos, eliminar caracteres no deseados y preparar los datos
            para el proceso de matching e integración posterior.
        </dcterms:description>

        <prov:wasDerivedFrom prov:entity="ex:l1books"/>

        <!-- Columnas como miembros -->
        <prov:hadMember prov:entity="ex:title"/>
        <prov:hadMember prov:entity="ex:description"/>
        <prov:hadMember prov:entity="ex:authors"/>
        <prov:hadMember prov:entity="ex:image"/>
        <prov:hadMember prov:entity="ex:previewlink"/>
        <prov:hadMember prov:entity="ex:publisher"/>
        <prov:hadMember prov:entity="ex:publisheddate"/>
        <prov:hadMember prov:entity="ex:infolink"/>
        <prov:hadMember prov:entity="ex:categories"/>
    </prov:entity>

    <!-- Columnas (definidas como entidades individuales) -->
    <prov:entity prov:id="ex:title">
        <prov:label>title</prov:label>
        <prov:type>xsd:string</prov:type>
        <dcterms:description>
            Se conserva como identificador principal del libro. Fue normalizado eliminando tildes, sustitución de "ñ" por "n",
            signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
            Esto garantiza comparabilidad y evita duplicados por diferencias de formato.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:description">
        <prov:label>description</prov:label>
        <prov:type>xsd:string</prov:type>
        <dcterms:description>
            Se mantiene sin transformación, pues contiene texto descriptivo libre.
            Permite enriquecer la información bibliográfica en etapas posteriores.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:authors">
        <prov:label>authors</prov:label>
        <prov:type>xsd:string</prov:type>
        <dcterms:description>
            Se conserva como lista de autores, aplicando normalización: eliminando tildes, sustitución de "ñ" por "n",
            signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
            Esto facilita el emparejamiento y agrupamiento de autores equivalentes.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:image">
        <prov:label>image</prov:label>
        <prov:type>xsd:anyURI</prov:type>
        <dcterms:description>
            Se mantiene sin cambios; representa el enlace a la imagen de portada original.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:previewlink">
        <prov:label>previewlink</prov:label>
        <prov:type>xsd:anyURI</prov:type>
        <dcterms:description>
            Se conserva sin alteraciones. Permite mantener la referencia a la vista previa del libro
            proveniente del dataset original.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:publisher">
        <prov:label>publisher</prov:label>
        <prov:type>xsd:string</prov:type>
        <dcterms:description>
            Se conserva tras aplicar normalización de texto: eliminando tildes, sustitución de "ñ" por "n",
            signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
            Esto permite unificar editoriales con variantes de nombre.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:publisheddate">
        <prov:label>publisheddate</prov:label>
        <prov:type>xsd:gYear</prov:type>
        <dcterms:description>
            Se conserva extrayendo únicamente el año cuando el valor original incluye fecha completa
            o timestamp. Los registros con valores inválidos o con carácter “?” fueron reemplazados
            por NULL. Se utiliza para la comparación temporal en el matching.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:infolink">
        <prov:label>infolink</prov:label>
        <prov:type>xsd:anyURI</prov:type>
        <dcterms:description>
            Enlace informativo original del libro. Se mantiene sin alteraciones.
        </dcterms:description>
    </prov:entity>

    <prov:entity prov:id="ex:categories">
        <prov:label>categories</prov:label>
        <prov:type>xsd:string</prov:type>
        <dcterms:description>
            Lista de categorías o géneros. Se mantiene sin limpieza en esta etapa, pues puede usarse
            para análisis o enriquecimiento posterior.
        </dcterms:description>
    </prov:entity>

    <!-- ACTIVIDAD -->
    <prov:activity prov:id="ex:normalize_l1booksstage1"
                   prov:startTime="2025-11-01T10:00:00"
                   prov:endTime="2025-11-01T10:40:00">
        <prov:label>Normalización de tabla l1books → l1booksstage1</prov:label>
        <dcterms:description>
            Proceso de transformación SQL ejecutado en PostgreSQL para limpiar y normalizar los textos
            de l1books. Incluye eliminación de tildes mediante la extensión unaccent, sustitución de "Ñ"
            por "N", eliminación de signos y puntuación, supresión de contenido entre paréntesis o corchetes,
            y compresión de espacios. En publisheddate se extrajo únicamente el año válido.
        </dcterms:description>
        <prov:used prov:entity="ex:l1books"/>
    </prov:activity>

    <!-- Agentes involucrados -->
    <prov:agent prov:id="ex:integra2">
        <prov:label>Grupo Integra2</prov:label>
        <prov:type>prov:Organization</prov:type>
        <prov:role>Encargado del diseño y ejecución del proceso de normalización.</prov:role>
    </prov:agent>

    <prov:agent prov:id="ex:postgresql_db">
        <prov:label>PostgreSQL Engine</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Motor de base de datos que ejecuta las consultas SQL de limpieza y transformación.</prov:role>
    </prov:agent>

    <prov:agent prov:id="ex:unaccent_extension">
        <prov:label>PostgreSQL unaccent extension</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Extensión utilizada para eliminar tildes y diacríticos de los textos durante la normalización.</prov:role>
    </prov:agent>

    <!-- Relaciones -->
    <prov:wasGeneratedBy prov:entity="ex:l1booksstage1"
                         prov:activity="ex:normalize_l1booksstage1"/>

    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:integra2"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:postgresql_db"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:unaccent_extension"/>
</prov:document>
