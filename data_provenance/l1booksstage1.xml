<?xml version="1.0" encoding="UTF-8"?>
<prov:document xmlns:prov="http://www.w3.org/ns/prov#"
               xmlns:xsd="http://www.w3.org/2001/XMLSchema#">

    <!-- Entidad: Tabla l1booksstage1 -->
    <prov:entity prov:id="ex:l1booksstage1">
        <prov:label>Tabla l1booksstage1</prov:label>
        <prov:description>
            Tabla intermedia generada a partir de l1_books, donde se aplican procesos de normalización
            sintáctica y limpieza de texto sobre los campos title, authors, publisher y publisheddate.
            Su objetivo es estandarizar formatos, eliminar caracteres no deseados y preparar los datos
            para el proceso de matching e integración posterior.
        </prov:description>
        
        <prov:wasDerivedFrom prov:entity="ex:l1_books"/>

        <!-- Columnas conservadas y normalizadas -->
        <prov:columns>

            <prov:column>
                <prov:name>title</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Se conserva como identificador principal del libro. Fue normalizado eliminando tildes, sustitución de "ñ" por "n",
                    signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
                    Esto garantiza comparabilidad y evita duplicados por diferencias de formato.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>description</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Se mantiene sin transformación, pues contiene texto descriptivo libre.
                    Permite enriquecer la información bibliográfica en etapas posteriores.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>authors</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Se conserva como lista de autores, aplicando normalización: eliminando tildes, sustitución de "ñ" por "n",
                    signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
                    Esto facilita el emparejamiento y agrupamiento de autores equivalentes.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>image</prov:name>
                <prov:type>xsd:anyURI</prov:type>
                <prov:reason>
                    Se mantiene sin cambios; representa el enlace a la imagen de portada original.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>previewLink</prov:name>
                <prov:type>xsd:anyURI</prov:type>
                <prov:reason>
                    Se conserva sin alteraciones. Permite mantener la referencia a la vista previa del libro
                    proveniente del dataset original.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>publisher</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Se conserva tras aplicar normalización de texto: eliminando tildes, sustitución de "ñ" por "n",
                    signos de puntuación, paréntesis, corchetes y espacios múltiples; convertido a mayúsculas.
                    Esto permite unificar editoriales con variantes de nombre.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>publisheddate</prov:name>
                <prov:type>xsd:gYear</prov:type>
                <prov:reason>
                    Se conserva extrayendo únicamente el año cuando el valor original incluye fecha completa
                    o timestamp. Los registros con valores inválidos o con carácter “?” fueron reemplazados
                    por NULL. Se utiliza para la comparación temporal en el matching.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>infoLink</prov:name>
                <prov:type>xsd:anyURI</prov:type>
                <prov:reason>
                    Enlace informativo original del libro. Se mantiene sin alteraciones.
                </prov:reason>
            </prov:column>

            <prov:column>
                <prov:name>categories</prov:name>
                <prov:type>xsd:string</prov:type>
                <prov:reason>
                    Lista de categorías o géneros. Se mantiene sin limpieza en esta etapa, pues puede usarse
                    para análisis o enriquecimiento posterior.
                </prov:reason>
            </prov:column>

        </prov:columns>
    </prov:entity>

    <!-- ACTIVIDAD -->
    <prov:activity prov:id="ex:normalize_l1booksstage1"
                   prov:startTime="2025-10-25T00:00:00"
                   prov:endTime="2025-10-25T02:00:00">
        <prov:label>Normalización de tabla l1_books → l1booksstage1</prov:label>
        <prov:description>
            Proceso de transformación SQL ejecutado en PostgreSQL para limpiar y normalizar los textos
            de l1_books. Incluye eliminación de tildes mediante la extensión unaccent, sustitución de "Ñ"
            por "N", eliminación de signos y puntuación, supresión de contenido entre paréntesis o corchetes,
            y compresión de espacios. En publisheddate se extrajo únicamente el año válido.
        </prov:description>
        <prov:used prov:entity="ex:l1_books"/>
    </prov:activity>

    <!-- Agentes involucrados -->
    <prov:agent prov:id="ex:integra2">
        <prov:label>Grupo Integra2</prov:label>
        <prov:type>prov:Organization</prov:type>
        <prov:role>Encargado del diseño y ejecución del proceso de normalización.</prov:role>
    </prov:agent>
    <prov:agent prov:id="ex:postgresql_db">
        <prov:label>PostgreSQL Engine</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Motor de base de datos que ejecuta las consultas SQL de limpieza y transformación.</prov:role>
    </prov:agent>
        </prov:agent>
        <prov:agent prov:id="ex:unaccent_extension">
        <prov:label>PostgreSQL unaccent extension</prov:label>
        <prov:type>prov:SoftwareAgent</prov:type>
        <prov:role>Extensión utilizada para eliminar tildes y diacríticos de los textos durante la normalización.</prov:role>
    </prov:agent>

    <!-- Relaciones -->
    <prov:wasGeneratedBy prov:entity="ex:l1booksstage1"
                         prov:activity="ex:normalize_l1booksstage1"/>

    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:integra2"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:postgresql_db"/>
    <prov:wasAssociatedWith prov:activity="ex:normalize_l1booksstage1"
                            prov:agent="ex:unaccent_extension"/>

</prov:document>
